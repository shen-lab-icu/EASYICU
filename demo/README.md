# PyRICU 演示脚本

本目录包含 PyRICU 可视化和 Web 应用的演示脚本。

## 文件说明

| 文件 | 说明 |
|------|------|
| `demo_with_mock_data.py` | **推荐** - 使用模拟数据演示，无需真实 ICU 数据 |
| `demo_visualization.py` | 使用真实数据的可视化演示 |
| `demo_webapp.py` | 启动交互式 Web 应用 |
| `demo_quick_start.py` | 快速上手示例 |
| `test_webapp_features.py` | Webapp 功能测试脚本 |

## 安装依赖

```bash
# 安装可视化依赖
pip install pyricu[viz]

# 安装 Web 应用依赖
pip install pyricu[webapp]

# 安装全部依赖
pip install pyricu[all]
```

## 快速开始（推荐）

使用模拟数据，无需配置真实 ICU 数据：

```bash
python demo_with_mock_data.py
```

这会生成 7 个 HTML 可视化文件到 `demo_output/` 目录。

## Web 应用功能

Web 应用提供完整的 ICU 数据分析平台，包含 5 个主要功能模块：

| 模块 | 功能 | 说明 |
|------|------|------|
| 🏠 首页 | 数据概览 | 查看已加载数据摘要和快速开始指南 |
| 📈 时序分析 | 时间序列可视化 | 交互式时序图，支持多患者对比 |
| 🏥 患者视图 | 单患者仪表盘 | 3种展示模式：综合仪表盘/分类视图/数据表格 |
| 📊 数据质量 | 质量评估 | 缺失率分析、数值分布、时间覆盖 |
| 💾 数据导出 | 批量导出 | 支持 CSV/Excel/Parquet，可按患者过滤 |

### 🎭 模拟数据模式

Web 应用支持模拟数据模式，无需真实 ICU 数据即可体验所有功能：

1. 在左侧栏勾选「使用模拟数据」
2. 设置模拟患者数量和时间跨度
3. 点击「生成模拟数据」
4. 探索各个功能标签页

## 使用方法

### 1. 可视化演示

```bash
# 使用默认数据路径
python demo_visualization.py

# 指定数据路径
python demo_visualization.py --data-path /path/to/ricu_data/miiv

# 指定输出目录
python demo_visualization.py --output-dir ./my_output

# 指定特定患者
python demo_visualization.py --patient-id 30041848
```

生成的 HTML 文件可在浏览器中打开查看。

### 2. Web 应用演示

```bash
# 使用默认端口 (8501)
python demo_webapp.py

# 指定端口
python demo_webapp.py --port 8080
```

然后在浏览器中访问 `http://localhost:8501`。

### 3. 快速上手

```bash
python demo_quick_start.py
```

## 输出示例

可视化演示会生成以下文件：

- `hr_timeline.html` - 心率时序图
- `vitals_panel.html` - 生命体征面板图
- `sofa_breakdown.html` - SOFA 评分分解图
- `sofa_trajectory.html` - SOFA 轨迹图
- `missing_heatmap.html` - 缺失值热力图
- `distribution_*.html` - 数值分布图
- `patient_*_dashboard.html` - 患者仪表盘

## 截图

### 首页
```
┌─────────────────────────────────────────────────────────┐
│  🏥 PyRICU Data Explorer                                │
├─────────────────────────────────────────────────────────┤
│  数据库: MIIV  │  Concepts: 12  │  患者: 50  │  ✅ 就绪 │
├─────────────────────────────────────────────────────────┤
│  📊 数据摘要                                            │
│  ┌──────────┬────────┬────────┐                        │
│  │ Concept  │ 记录数 │ 患者数 │                        │
│  ├──────────┼────────┼────────┤                        │
│  │ hr       │ 12,500 │   50   │                        │
│  │ map      │ 11,800 │   50   │                        │
│  │ ...      │   ...  │   ...  │                        │
│  └──────────┴────────┴────────┘                        │
└─────────────────────────────────────────────────────────┘
```

### 患者视图
```
┌─────────────────────────────────────────────────────────┐
│  🏥 患者视图 - 患者 #12345                              │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ HR: 82 bpm  │  │ MAP: 75mmHg │  │ SpO2: 97%  │      │
│  │ ▄▄▅▅▆▅▄    │  │ ▅▄▃▄▅▆▅    │  │ ▇▇▇▇▇▇▇    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
│                                                         │
│  📊 SOFA 评分分解                                       │
│  [========] Respiratory: 2                              │
│  [====    ] Cardiovascular: 1                           │
│  [==      ] Coagulation: 0                              │
└─────────────────────────────────────────────────────────┘
```

## 注意事项

1. **数据隐私**: 所有数据处理在本地完成，不会上传到任何服务器
2. **数据格式**: 需要 RICU 格式的 parquet 数据文件
3. **内存需求**: 大数据集可能需要较多内存，建议限制患者数量
