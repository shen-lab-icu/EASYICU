{
  "sofa2": {
    "concepts": [
      "sofa2_resp",
      "sofa2_coag",
      "sofa2_liver",
      "sofa2_cardio",
      "sofa2_cns",
      "sofa2_renal"
    ],
    "description": "SOFA-2 (2025) aggregate score",
    "category": "outcome",
    "callback": "sofa2_score",
    "class_name": "rec_cncpt"
  },
  "sofa2_resp": {
    "concepts": [
      "pafi",
      "spo2",
      "fio2",
      "adv_resp",
      "ecmo",
      "ecmo_indication"
    ],
    "description": "SOFA-2 respiratory component (P/F≤300/225/150/75 with advanced support; ECMO auto-4 if respiratory indication)",
    "category": "outcome",
    "callback": "sofa2_resp",
    "class_name": "rec_cncpt"
  },
  "sofa2_coag": {
    "concepts": "plt",
    "description": "SOFA-2 hemostasis component (updated thresholds: ≤150/100/80/50)",
    "category": "outcome",
    "callback": "sofa2_coag",
    "class_name": "rec_cncpt",
    "aggregate": "min"
  },
  "sofa2_liver": {
    "concepts": "bili",
    "description": "SOFA-2 liver component (relaxed 1pt threshold: ≤3.0 mg/dL vs ≤1.9 in SOFA-1)",
    "category": "outcome",
    "aggregate": "max",
    "callback": "sofa2_liver",
    "class_name": "rec_cncpt"
  },
  "sofa2_cardio": {
    "concepts": [
      "map",
      "norepi60",
      "epi60",
      "dopa60",
      "dobu60",
      "other_vaso",
      "mech_circ_support"
    ],
    "description": "SOFA-2 cardiovascular component (combined norepi+epi: ≤0.2/0.2-0.4/>0.4 μg/kg/min; dopamine backup only; mechanical support)",
    "category": "outcome",
    "aggregate": [
      "min",
      "max",
      "max",
      "max",
      "max",
      null,
      null
    ],
    "callback": "sofa2_cardio",
    "class_name": "rec_cncpt"
  },
  "sofa2_cns": {
    "concepts": [
      "gcs",
      "delirium_tx",
      "delirium_positive",
      "motor_response"
    ],
    "description": "SOFA-2 brain component (GCS 15/13-14/9-12/6-8/3-5; delirium treatment or positive CAM-ICU → 1pt even if GCS=15; motor response as GCS alternative)",
    "category": "outcome",
    "callback": "sofa2_cns",
    "class_name": "rec_cncpt"
  },
  "sofa2_renal": {
    "concepts": [
      "crea",
      "rrt",
      "rrt_criteria",
      "uo_6h",
      "uo_12h",
      "uo_24h",
      "potassium",
      "ph",
      "bicarb"
    ],
    "description": "SOFA-2 renal component with duration-based UO (6h/12h/24h windows for accurate temporal scoring)",
    "category": "outcome",
    "aggregate": [
      "max",
      null,
      null,
      "min",
      "min",
      "min",
      "max",
      "min",
      "min"
    ],
    "callback": "sofa2_renal",
    "class_name": "rec_cncpt"
  },
  "uo_6h": {
    "concepts": [
      "urine",
      "weight"
    ],
    "description": "6-hour average urine output in mL/kg/h (for SOFA-2: <0.5 for 6-12h \u2192 Score 1)",
    "category": "output",
    "callback": "uo_6h",
    "class_name": "rec_cncpt"
  },
  "uo_12h": {
    "concepts": [
      "urine",
      "weight"
    ],
    "description": "12-hour average urine output in mL/kg/h (for SOFA-2: <0.5 for \u226512h \u2192 Score 2; anuria \u226512h \u2192 Score 3)",
    "category": "output",
    "callback": "uo_12h",
    "class_name": "rec_cncpt"
  },
  "uo_24h": {
    "concepts": [
      "urine",
      "weight"
    ],
    "description": "24-hour average urine output in mL/kg/h (for SOFA-2: <0.3 for \u226524h \u2192 Score 3)",
    "category": "output",
    "callback": "uo_24h",
    "class_name": "rec_cncpt"
  },
  "adv_resp": {
    "class_name": "lgl_cncpt",
    "description": "Advanced respiratory support (IMV/NIV/HFNC/CPAP/BiPAP) - validated: 39280 stays with ventilator, 6152 with HFNC",
    "category": "respiratory",
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [
            223848,
            223849,
            227577,
            227583,
            225949
          ],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "223848=Ventilator Type (39280 stays), 223849=Ventilator Mode (27164), 227577=BiPap Mode (3918), 227583=Autoset/CPAP (2791), 225949=NIV Mask (2041)"
        },
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [226732],
          "val_var": "value",
          "regex": "High flow|HFNC|Bipap|CPAP",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "226732=Oxygen Delivery Device, filter for HFNC/BiPAP/CPAP values (6152 stays with high flow)"
        }
      ],
      "eicu": [
        {
          "table": "respiratorycare",
          "sub_var": "ventstartoffset",
          "val_var": "ventstartoffset",
          "callback": "transform_fun(set_val(TRUE))"
        },
        {
          "table": "respiratorycharting",
          "sub_var": "respchartvaluelabel",
          "regex": "CPAP|BiPAP|NIV|PEEP/CPAP|Bipap|HFNC|High Flow",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "aumc": [
        {
          "table": "listitems",
          "sub_var": "item",
          "regex": "(CPAP|Bipap|NIV|IPPV|SIMV|ASB|MMV|BIPAP|HFNC|High Flow)",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        },
        {
          "table": "listitems",
          "sub_var": "itemid",
          "ids": [
            6685,
            6694
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "hirid": [
        {
          "table": "observations",
          "sub_var": "variableid",
          "ids": [
            3845,
            15001552
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ]
    }
  },
  "ecmo": {
    "class_name": "lgl_cncpt",
    "description": "Extracorporeal membrane oxygenation in use - validated: 155 stays with Circuit Config, 41 with Oxygenator/ECMO",
    "category": "respiratory",
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [
            229268,
            228193,
            224660,
            229270
          ],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "229268=Circuit Configuration (155 stays, best indicator), 228193=Oxygenator/ECMO (41), 224660=ECMO (5), 229270=Flow (ECMO)"
        }
      ],
      "eicu": [
        {
          "table": "treatment",
          "sub_var": "treatmentstring",
          "regex": "ECMO",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "aumc": [
        {
          "table": "listitems",
          "sub_var": "itemid",
          "ids": [
            20662
          ],
          "callback": "transform_fun(set_val(TRUE))"
        },
        {
          "table": "procedureorderitems",
          "sub_var": "item",
          "regex": "ECMO",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "hirid": []
    }
  },
  "ecmo_indication": {
    "class_name": "chr_cncpt",
    "description": "ECMO indication - MIMIC-IV 229268 has explicit VV/VA values (17950 VV, 9926 VA)",
    "category": "respiratory",
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [229268],
          "val_var": "value",
          "callback": "apply_map(c(`VV` = 'respiratory', `VA` = 'cardiovascular', `VAV` = 'cardiovascular'), var = 'value')",
          "_comment": "229268=Circuit Configuration: VV=17950 (respiratory), VA=9926 (cardiovascular), VAV=41"
        }
      ],
      "eicu": [
        {
          "table": "treatment",
          "sub_var": "treatmentstring",
          "regex": "VV.*ECMO|ECMO.*respiratory",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val('respiratory'))"
        },
        {
          "table": "treatment",
          "sub_var": "treatmentstring",
          "regex": "VA.*ECMO|ECMO.*cardio",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val('cardiovascular'))"
        }
      ],
      "aumc": [
        {
          "table": "listitems",
          "sub_var": "itemid",
          "ids": [
            20662
          ],
          "callback": "apply_map(c(`VA ECMO` = 'cardiovascular', `VV ECMO` = 'respiratory'), var = 'value')"
        }
      ],
      "hirid": []
    }
  },
  "motor_response": {
    "class_name": "num_cncpt",
    "description": "GCS Motor Response (1-6 scale) - for SOFA-2 when full GCS unavailable",
    "category": "neurology",
    "unit": "score",
    "min": 1,
    "max": 6,
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [223901],
          "_comment": "223901=GCS - Motor Response"
        }
      ],
      "eicu": [
        {
          "table": "nursecharting",
          "sub_var": "nursingchartcelltypevallabel",
          "regex": "GCS.*Motor",
          "class_name": "rgx_itm"
        }
      ],
      "aumc": [],
      "hirid": []
    }
  },
  "delirium_positive": {
    "class_name": "lgl_cncpt",
    "description": "Positive delirium assessment (CAM-ICU positive) - 72944 stays with assessment, 119052 positive results",
    "category": "neurology",
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [228332],
          "val_var": "value",
          "regex": "^Positive$",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "228332=Delirium assessment: Positive=119052, Negative=361125, UTA=130455"
        }
      ],
      "eicu": [
        {
          "table": "nursecharting",
          "sub_var": "nursingchartcelltypevallabel",
          "regex": "CAM-ICU.*positive|Delirium.*positive",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "aumc": [],
      "hirid": []
    }
  },
  "mech_circ_support": {
    "class_name": "lgl_cncpt",
    "description": "Mechanical circulatory support - validated: IABP (1226 stays), Impella (220), Tandem (41), LVAD (11), RVAD (6)",
    "category": "cardiovascular",
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [
            224322,
            225979,
            228154,
            228198,
            229254,
            220128
          ],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "224322=IABP Mean (1226 stays), 225979=IABP Size (1154), 228154=Flow Rate Impella (220), 228198=Tandem Heart Flow (41), 229254=Flow LVAD (11), 220128=RVAD Flow (6)"
        }
      ],
      "eicu": [
        {
          "table": "treatment",
          "sub_var": "treatmentstring",
          "regex": "IABP|balloon pump|LVAD|Impella|Tandem",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "aumc": [
        {
          "table": "procedureorderitems",
          "sub_var": "item",
          "regex": "(IABP|balloon|Impella|LVAD)",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        },
        {
          "table": "listitems",
          "sub_var": "itemid",
          "ids": [
            6658
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "hirid": [
        {
          "table": "observations",
          "sub_var": "variableid",
          "ids": [],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ]
    }
  },
  "other_vaso": {
    "class_name": "lgl_cncpt",
    "description": "Other vasoactive medication - validated: Phenylephrine (14428 stays), Vasopressin (5626), Milrinone (1279)",
    "category": "cardiovascular",
    "sources": {
      "miiv": [
        {
          "table": "inputevents",
          "sub_var": "itemid",
          "ids": [
            221749,
            222315,
            221986,
            229630,
            229632
          ],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "221749=Phenylephrine (14428), 222315=Vasopressin (5626), 221986=Milrinone (1279), 229630=Phenylephrine 50/250 (3778), 229632=Phenylephrine 200/250 (453)"
        }
      ],
      "eicu": [
        {
          "table": "medication",
          "sub_var": "drugname",
          "regex": "vasopressin|phenylephrine|milrinone",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))",
          "val_var": "drugname"
        },
        {
          "table": "infusiondrug",
          "sub_var": "drugname",
          "regex": "vasopressin|phenylephrine|milrinone",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))",
          "val_var": "drugname"
        }
      ],
      "aumc": [
        {
          "table": "drugitems",
          "sub_var": "item",
          "regex": "(Fenylefrine|vasopressin|milrinone)",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "hirid": [
        {
          "table": "pharma",
          "sub_var": "pharmacode",
          "ids": [
            112,
            113
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ]
    }
  },
  "delirium_tx": {
    "class_name": "lgl_cncpt",
    "description": "Delirium treatment - validated: Haloperidol IV (3972 stays), prescriptions much larger (16198+ patients)",
    "category": "neurology",
    "sources": {
      "miiv": [
        {
          "table": "inputevents",
          "sub_var": "itemid",
          "ids": [221824],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "221824=Haloperidol IV (3972 stays, 14988 records)"
        },
        {
          "table": "prescriptions",
          "sub_var": "drug",
          "regex": "[Hh]aloperidol|[Qq]uetiapine|[Oo]lanzapine|[Rr]isperidone",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "Haloperidol=16198 patients, Quetiapine=10770+, Olanzapine=6236+, Risperidone=1647+"
        }
      ],
      "eicu": [
        {
          "table": "medication",
          "sub_var": "drugname",
          "val_var": "drugname",
          "regex": "haloperidol|quetiapine|olanzapine|risperidone",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "aumc": [
        {
          "table": "drugitems",
          "sub_var": "itemid",
          "ids": [
            7097,
            13012,
            16360
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "hirid": [
        {
          "table": "pharma",
          "sub_var": "pharmaid",
          "ids": [
            239
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ]
    }
  },
  "rrt": {
    "class_name": "lgl_cncpt",
    "description": "Renal replacement therapy - validated: CRRT mode (2780 stays), Hemodialysis (2746), CRRT procedure (2274)",
    "category": "renal",
    "sources": {
      "miiv": [
        {
          "table": "chartevents",
          "sub_var": "itemid",
          "ids": [227290],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "227290=CRRT mode (2780 stays, 203035 records) - best RRT indicator"
        },
        {
          "table": "procedureevents",
          "sub_var": "itemid",
          "ids": [
            225441,
            225802
          ],
          "callback": "transform_fun(set_val(TRUE))",
          "_comment": "225441=Hemodialysis (2746 stays), 225802=Dialysis-CRRT (2274 stays)"
        }
      ],
      "eicu": [
        {
          "table": "treatment",
          "sub_var": "treatmentstring",
          "regex": "(CRRT|hemodialysis|dialysis)",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "aumc": [
        {
          "table": "procedureorderitems",
          "sub_var": "item",
          "regex": "(CRRT|Hemodialysis|Dialysis|CVVH)",
          "class_name": "rgx_itm",
          "callback": "transform_fun(set_val(TRUE))"
        },
        {
          "table": "numericitems",
          "sub_var": "itemid",
          "ids": [
            6684
          ],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ],
      "hirid": [
        {
          "table": "observations",
          "sub_var": "variableid",
          "ids": [],
          "callback": "transform_fun(set_val(TRUE))"
        }
      ]
    }
  },
  "rrt_criteria": {
    "class_name": "lgl_cncpt",
    "description": "Meets criteria for RRT but not receiving it (crea>1.2 mg/dL or oliguria>6h PLUS K+\u22656.0 OR acidosis pH\u22647.20+HCO3\u226412)",
    "category": "renal",
    "sources": {
      "miiv": [],
      "eicu": [],
      "aumc": [],
      "hirid": []
    },
    "target": "id_tbl",
    "callback": "rrt_criteria"
  }
}
