{
  "_metadata": {
    "description": "pyricu功能实现追踪文件 - 对比ricu R包的功能实现状态",
    "created": "2024-12-24",
    "last_updated": "2024-12-24",
    "ricu_version": "0.6.1",
    "pyricu_version": "0.1.0"
  },
  
  "concepts": {
    "_description": "概念定义 - 来自concept-dict.json的临床概念",
    
    "implemented_from_ricu": {
      "_description": "从ricu移植的概念，已完全实现",
      "vitals": ["hr", "sbp", "dbp", "map", "temp", "resp", "spo2", "o2sat", "sao2"],
      "labs": ["alb", "alp", "alt", "ast", "basos", "be", "bicar", "bili", "bili_dir", "bnd", "bun", "ca", "cai", "ck", "ckmb", "cl", "cort", "crea", "crp", "eos", "esr", "fgn", "glu", "hba1c", "hbco", "hct", "hgb", "inr_pt", "k", "lact", "lymph", "mch", "mchc", "mcv", "methb", "mg", "na", "neut", "pco2", "ph", "phos", "plt", "po2", "pt", "ptt", "rbc", "rdw", "tco2", "tri", "tnt", "wbc"],
      "demographics": ["age", "sex", "height", "weight", "adm"],
      "outcomes": ["death", "los_hosp", "los_icu"],
      "medications": ["abx", "ins", "dex", "adh_rate", "phn_rate"],
      "vasopressors": ["dopa_rate", "dopa_dur", "dopa60", "dobu_rate", "dobu_dur", "dobu60", "epi_rate", "epi_dur", "epi60", "norepi_rate", "norepi_dur", "norepi60", "norepi_equiv"],
      "respiratory": ["fio2", "etco2", "vent_start", "vent_end", "vent_ind", "mech_vent", "supp_o2"],
      "neurological": ["egcs", "vgcs", "mgcs", "tgcs", "gcs", "rass", "ett_gcs", "avpu"],
      "renal": ["urine", "urine24"],
      "derived": ["pafi", "safi", "bmi", "vaso_ind", "samp"]
    },
    
    "new_concepts_pyricu": {
      "_description": "pyricu新增的概念，ricu中没有",
      "sofa2_specific": {
        "description": "SOFA-2 (2025版本)相关概念",
        "concepts": ["adv_resp", "ecmo", "ecmo_indication", "motor_response", "delirium_positive", "delirium_tx", "mech_circ_support", "other_vaso", "rrt", "rrt_criteria", "uo_6h", "uo_12h", "uo_24h"]
      },
      "additional": {
        "description": "其他新增概念",
        "concepts": ["bicarb", "potassium", "sedated_gcs", "infection_icd"]
      }
    },
    
    "not_implemented": {
      "_description": "ricu中有但pyricu尚未完全验证的概念",
      "concepts": []
    }
  },
  
  "scores": {
    "_description": "临床评分系统",
    
    "implemented": {
      "sofa": {
        "status": "完成",
        "description": "SOFA (Sequential Organ Failure Assessment) 评分",
        "components": ["sofa_resp", "sofa_coag", "sofa_liver", "sofa_cardio", "sofa_cns", "sofa_renal"],
        "callback": "sofa_score",
        "notes": "完全复制ricu逻辑，包含24h滑动窗口"
      },
      "sofa2": {
        "status": "完成",
        "description": "SOFA-2 (2025版本) 评分 - pyricu新增",
        "components": ["sofa2_resp", "sofa2_coag", "sofa2_liver", "sofa2_cardio", "sofa2_cns", "sofa2_renal"],
        "callback": "sofa2_score",
        "notes": "基于2025年SOFA-2共识指南实现"
      },
      "sirs": {
        "status": "完成",
        "description": "SIRS (Systemic Inflammatory Response Syndrome) 评分",
        "components": ["temp", "hr", "resp", "wbc", "pco2", "bnd"],
        "callback": "sirs_score"
      },
      "qsofa": {
        "status": "完成",
        "description": "qSOFA (Quick SOFA) 评分",
        "components": ["gcs", "sbp", "resp"],
        "callback": "qsofa_score"
      },
      "news": {
        "status": "完成",
        "description": "NEWS (National Early Warning Score) 评分",
        "components": ["hr", "avpu", "supp_o2", "o2sat", "temp", "sbp", "resp"],
        "callback": "news_score"
      },
      "mews": {
        "status": "完成",
        "description": "MEWS (Modified Early Warning Score) 评分",
        "components": ["hr", "avpu", "temp", "sbp", "resp"],
        "callback": "mews_score"
      }
    },
    
    "not_implemented": {
      "_description": "ricu中存在但pyricu尚未实现的评分",
      "scores": []
    }
  },
  
  "sepsis_detection": {
    "_description": "脓毒症检测相关功能",
    
    "implemented": {
      "sep3": {
        "status": "完成",
        "description": "Sepsis-3 定义检测",
        "dependencies": ["sofa", "susp_inf"],
        "callback": "sep3",
        "notes": "实现了delta_cummin, delta_start, delta_min等函数"
      },
      "susp_inf": {
        "status": "完成",
        "description": "疑似感染检测",
        "dependencies": ["abx", "samp"],
        "modes": ["and", "or", "abx", "samp"],
        "callback": "susp_inf"
      },
      "sep3_sofa2": {
        "status": "完成",
        "description": "基于SOFA-2的Sepsis-3检测 - pyricu新增",
        "dependencies": ["sofa2", "susp_inf"],
        "callback": "sep3_sofa2"
      }
    }
  },
  
  "table_classes": {
    "_description": "数据表类型",
    
    "implemented": {
      "IdTbl": {
        "status": "完成",
        "r_equivalent": "id_tbl",
        "description": "带ID变量的数据表",
        "file": "table.py"
      },
      "TsTbl": {
        "status": "完成",
        "r_equivalent": "ts_tbl",
        "description": "时间序列数据表",
        "file": "table.py"
      },
      "WinTbl": {
        "status": "完成",
        "r_equivalent": "win_tbl",
        "description": "窗口数据表（带持续时间）",
        "file": "table.py"
      },
      "ICUTable": {
        "status": "完成",
        "description": "ICU数据表的高级封装",
        "file": "table.py"
      }
    }
  },
  
  "time_series_utilities": {
    "_description": "时间序列工具函数",
    
    "implemented": {
      "fill_gaps": {
        "status": "完成",
        "r_equivalent": "fill_gaps",
        "description": "填充时间序列间隙",
        "file": "ts_utils.py"
      },
      "slide": {
        "status": "完成",
        "r_equivalent": "slide",
        "description": "滑动窗口操作",
        "file": "ts_utils.py"
      },
      "slide_index": {
        "status": "完成",
        "r_equivalent": "slide_index",
        "description": "基于索引的滑动窗口",
        "file": "ts_utils.py"
      },
      "hop": {
        "status": "完成",
        "r_equivalent": "hop",
        "description": "跳跃窗口操作",
        "file": "ts_utils.py"
      },
      "expand": {
        "status": "完成",
        "r_equivalent": "expand",
        "description": "展开时间区间",
        "file": "ts_utils.py"
      },
      "collapse": {
        "status": "完成",
        "r_equivalent": "collapse",
        "description": "折叠时间序列",
        "file": "ts_utils.py"
      },
      "stay_windows": {
        "status": "完成",
        "r_equivalent": "stay_windows",
        "description": "获取ICU住院窗口",
        "file": "ts_utils.py, data_utils.py"
      }
    },
    
    "not_implemented": []
  },
  
  "callback_utilities": {
    "_description": "回调函数工具",
    
    "implemented": {
      "transform_fun": {
        "status": "完成",
        "description": "值转换函数工厂",
        "file": "callback_utils.py"
      },
      "apply_map": {
        "status": "完成",
        "description": "值映射函数工厂",
        "file": "callback_utils.py"
      },
      "convert_unit": {
        "status": "完成",
        "description": "单位转换函数工厂",
        "file": "callback_utils.py, unit_conversion.py"
      },
      "binary_op": {
        "status": "完成",
        "description": "二元运算函数工厂",
        "file": "callback_utils.py"
      },
      "set_val": {
        "status": "完成",
        "description": "设置固定值函数",
        "file": "callback_utils.py"
      },
      "fahr_to_cels": {
        "status": "完成",
        "description": "华氏温度转摄氏度",
        "file": "callback_utils.py"
      }
    }
  },
  
  "concept_callbacks": {
    "_description": "概念回调函数 (callback-cncpt.R 对应)",
    
    "implemented": {
      "pafi": {
        "status": "完成",
        "description": "PaO2/FiO2比值计算",
        "modes": ["match_vals", "extreme_vals", "fill_gaps"],
        "file": "callbacks.py, concept_callbacks.py"
      },
      "safi": {
        "status": "完成",
        "description": "SpO2/FiO2比值计算",
        "file": "callbacks.py"
      },
      "vent_ind": {
        "status": "完成",
        "description": "机械通气指示",
        "file": "clinical_utils.py, concept_callbacks.py"
      },
      "gcs": {
        "status": "完成",
        "description": "GCS评分计算（含sedation imputation）",
        "file": "clinical_utils.py, concept_callbacks.py"
      },
      "urine24": {
        "status": "完成",
        "description": "24小时尿量计算",
        "file": "clinical_utils.py, concept_callbacks.py"
      },
      "vaso60": {
        "status": "完成",
        "description": "60分钟血管活性药物过滤",
        "notes": "过滤持续时间>=1h的给药事件",
        "file": "concept_callbacks.py"
      },
      "vaso_ind": {
        "status": "完成",
        "description": "血管活性药物指示",
        "file": "clinical_utils.py"
      },
      "norepi_equiv": {
        "status": "完成",
        "description": "去甲肾上腺素等效剂量",
        "file": "clinical_utils.py, concept_callbacks.py"
      },
      "bmi": {
        "status": "完成",
        "description": "BMI计算",
        "file": "clinical_utils.py"
      },
      "avpu": {
        "status": "完成",
        "description": "AVPU意识评估",
        "file": "clinical_utils.py"
      },
      "supp_o2": {
        "status": "完成",
        "description": "补充氧气指示",
        "file": "clinical_utils.py"
      }
    },
    
    "partially_implemented": {},
    
    "not_implemented": []
  },
  
  "data_sources": {
    "_description": "支持的ICU数据库",
    
    "fully_supported": {
      "miiv": {
        "name": "MIMIC-IV",
        "status": "完成",
        "notes": "主要开发和测试数据库"
      },
      "eicu": {
        "name": "eICU-CRD",
        "status": "完成",
        "notes": "已验证核心概念"
      },
      "aumc": {
        "name": "AmsterdamUMCdb",
        "status": "完成",
        "notes": "已修复药物单位问题"
      }
    },
    
    "partially_supported": {
      "hirid": {
        "name": "HiRID",
        "status": "部分支持",
        "notes": "基础概念已定义，但验证较少"
      }
    },
    
    "not_supported": {
      "mimic": {
        "name": "MIMIC-III",
        "status": "未实现",
        "notes": "ricu支持，pyricu未移植（建议使用MIMIC-IV）"
      },
      "sic": {
        "name": "SICdb",
        "status": "未实现",
        "notes": "ricu支持，pyricu未移植"
      }
    }
  },
  
  "data_loading": {
    "_description": "数据加载功能",
    
    "implemented": {
      "load_concepts": {
        "status": "完成",
        "description": "加载临床概念数据",
        "r_equivalent": "load_concepts",
        "file": "load_concepts.py, concept.py"
      },
      "load_dictionary": {
        "status": "完成",
        "description": "加载概念字典",
        "r_equivalent": "load_dictionary",
        "file": "concept.py"
      },
      "attach_src": {
        "status": "完成",
        "description": "附加数据源",
        "r_equivalent": "attach_src",
        "file": "attach.py"
      },
      "load_id": {
        "status": "完成",
        "description": "加载ID表数据",
        "r_equivalent": "load_id",
        "file": "data_load.py"
      },
      "load_ts": {
        "status": "完成",
        "description": "加载时间序列数据",
        "r_equivalent": "load_ts",
        "file": "data_load.py"
      },
      "load_difftime": {
        "status": "完成",
        "description": "加载时间差数据",
        "r_equivalent": "load_difftime",
        "file": "data_load.py"
      }
    },
    
    "not_implemented": {
      "setup_src_data": {
        "status": "不需要",
        "description": "设置源数据（下载/导入）",
        "notes": "pyricu使用预处理好的parquet格式数据"
      },
      "import_src": {
        "status": "未实现",
        "description": "从原始CSV导入数据",
        "notes": "ricu支持的CSV导入功能，pyricu不需要"
      }
    }
  },
  
  "table_utilities": {
    "_description": "数据表操作工具 (tbl-utils.R 对应)",
    
    "implemented": {
      "id_vars": {"status": "完成", "description": "获取ID变量名", "file": "table.py"},
      "index_var": {"status": "完成", "description": "获取索引变量名", "file": "table.py"},
      "data_vars": {"status": "完成", "description": "获取数据变量名", "file": "table.py"},
      "meta_vars": {"status": "完成", "description": "获取元数据变量名", "file": "table.py"},
      "interval": {"status": "完成", "description": "获取时间间隔", "file": "table.py"},
      "time_unit": {"status": "完成", "description": "获取时间单位", "file": "table.py"},
      "rename_cols": {"status": "完成", "description": "重命名列", "file": "table_utils.py"},
      "rm_cols": {"status": "完成", "description": "删除列", "file": "table_utils.py"},
      "aggregate": {"status": "完成", "description": "聚合数据", "file": "data_utils.py"},
      "merge_tables": {"status": "完成", "description": "合并表", "file": "data_utils.py"},
      "change_id": {"status": "完成", "description": "变更ID类型", "file": "table.py, table_utils.py"},
      "filter_bounds": {"status": "完成", "description": "过滤边界值", "file": "table_utils.py"},
      "is_sorted": {"status": "完成", "description": "检查排序", "file": "table.py"},
      "is_unique": {"status": "完成", "description": "检查唯一性", "file": "table.py"}
    }
  },

  "item_callbacks": {
    "_description": "数据项回调函数 (callback-itm.R 对应)",
    
    "implemented": {
      "mimic_rate_mv": {"status": "完成", "description": "MIMIC MV费率处理"},
      "aumc_rate_units": {"status": "完成", "description": "AUMC费率单位处理"},
      "eicu_rate_units": {"status": "完成", "description": "eICU费率单位处理"},
      "hirid_rate": {"status": "完成", "description": "HiRID费率处理"},
      "eicu_age": {"status": "完成", "description": "eICU年龄处理"},
      "eicu_adx": {"status": "完成", "description": "eICU入院诊断处理"},
      "mimic_sampling": {"status": "完成", "description": "MIMIC采样处理"},
      "percent_as_numeric": {"status": "完成", "description": "百分比转数值"}
    },
    
    "not_implemented": {
      "hirid_death": {"status": "未验证", "description": "HiRID死亡处理"}
    }
  },
  
  "pyricu_exclusive_features": {
    "_description": "pyricu独有功能（ricu没有）",
    
    "sofa2_system": {
      "description": "完整的SOFA-2 (2025)实现",
      "components": [
        "sofa2_resp - 呼吸评分（含ECMO自动4分）",
        "sofa2_coag - 凝血评分（更新阈值）",
        "sofa2_liver - 肝脏评分（放宽1分阈值）",
        "sofa2_cardio - 心血管评分（联合血管活性药物）",
        "sofa2_cns - 中枢神经评分（含谵妄评估）",
        "sofa2_renal - 肾脏评分（基于持续时间的尿量）"
      ],
      "files": ["sofa2.py", "callbacks.py", "sofa2-dict.json"]
    },
    
    "memory_optimization": {
      "description": "内存优化系统",
      "features": ["批处理", "内存监控", "自动垃圾回收"],
      "file": "memory_optimizer.py"
    },
    
    "ricu_compatibility_layer": {
      "description": "与ricu R包结果兼容性层",
      "file": "ricu_compat.py"
    },
    
    "performance_tools": {
      "description": "性能分析工具",
      "file": "performance.py"
    }
  },
  
  "testing": {
    "_description": "测试覆盖情况",
    
    "test_files": [
      "tests/test_concepts.py",
      "tests/test_sofa2.py",
      "tests/test_table.py",
      "tests/test_callbacks.py"
    ],
    
    "validation_scripts": [
      "compare_ricu_pyricu.py",
      "verify_features.py"
    ]
  },
  
  "known_issues": {
    "_description": "已知问题和限制",
    
    "issues": [
      {
        "id": 1,
        "description": "MIMIC-III不支持（仅支持MIMIC-IV）",
        "severity": "低",
        "workaround": "使用MIMIC-IV"
      },
      {
        "id": 2,
        "description": "HiRID数据验证较少",
        "severity": "中",
        "workaround": "需要更多测试"
      }
    ]
  },
  
  "validation_status": {
    "_description": "与ricu对比验证状态",
    
    "validated_databases": {
      "miiv": {
        "sofa_components": "已验证",
        "demographics": "已验证",
        "labs": "已验证",
        "vitals": "已验证"
      },
      "eicu": {
        "sofa_components": "已验证",
        "demographics": "已验证"
      },
      "aumc": {
        "sofa_components": "已验证",
        "vasopressors": "已验证（修复单位问题后）"
      }
    }
  }
}
